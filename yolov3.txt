YOLO V3 REAL TIME OBJECT DETECTION

1. Import

import cv2
import numpy as np
import time
import os

- cv2 - openCV, used for computer vision like reading webcame frames, drawing boxes, etc
- numpy - array manipulations, bounding box colors and calculaton
- time - calculate fps
- os - handle file paths safely

2. Base directory

BASE_DIR = os.path.dirname(os.path.abspath(__file__))

- stores directory of script itself so can used for reference weights, cfg, coco

3. Load Yolo

net = cv2.dnn.readNet(
    os.path.join(BASE_DIR, "weights", "yolov3-tiny.weights"),
    os.path.join(BASE_DIR, "cfg", "yolov3-tiny.cfg")
)

- Load yolo either YOLOv3 or YOLOv3-Tiny
- .weights - pre-trained weights
- .cfg - model architecture

4. Load Class Names

classes = []
with open(os.path.join(BASE_DIR, "coco.names"), "r") as f:
    classes = [line.strip() for line in f.readlines()]

- loads name of objects YOLO can detect like person, cell phone etc

4. Get Output Layes

layer_names = net.getLayerNames()
output_layers = [layer_names[i - 1] for i in net.getUnconnectedOutLayers().flatten()]

- output_layers for detection
- getUnconnectedOutLayers() gives the indices of output layers
- flatten() converts it to a list.

5. Random Colors

colors = np.random.uniform(0, 255, size=(len(classes), 3))

- assign unique color to each box based on the objects

6. Open Webcam

cap = cv2.VideoCapture(3)

- Open webcam device 3, usually laptop built in camera is 0

7. Main Loop

while True:
    ret, frame = cap.read()
    if not ret:
        break

    frame_id += 1
    height, width, _ = frame.shape

- read each frame from the webcam
- ret - true if frame capture successfully
- frame.shape - gets dimensions of the frame

8. Preprocess Frame

blob = cv2.dnn.blobFromImage(frame, 0.00392, (320, 320), (0, 0, 0), True, crop=False)
net.setInput(blob)
outs = net.forward(output_layers)

- converts frame into a blob(standard input for YOLO)
	- 0.00392 - scales pixel values to 0â€“1.
	- (320, 320) - YOLOv3-Tiny input size (can also use 416x416).
	- (0, 0, 0) - mean subtraction.
- Sends the blob to YOLO network and gets outputs from output layers

9. Parse Detections

for out in outs:
    for detection in out:
        scores = detection[5:]
        class_id = np.argmax(scores)
        confidence = scores[class_id]

        if confidence > 0.4:
            center_x = int(detection[0] * width)
            center_y = int(detection[1] * height)
            w = int(detection[2] * width)
            h = int(detection[3] * height)

            x = int(center_x - w / 2)
            y = int(center_y - h / 2)

            boxes.append([x, y, w, h])
            confidences.append(float(confidence))
            class_ids.append(class_id)

- YOLO outputs and array [center_x, center_y, width, height, objectness, class_scores...]
- scores = detection[5:] - probability for each class
- class_id = np.argmax(scores) - class with highest probability
- Confidence threshold (>0.4) filters weak detections
- Calculates bounding box coordinates from center + width/height

10. Non-Mac Suppression

indexes = cv2.dnn.NMSBoxes(boxes, confidences, 0.3, 0.3)

- eliminates overlapping boxes for same object

11. Draw Bounding Boxes

for i in indexes.flatten():
    x, y, w, h = boxes[i]
    label = classes[class_ids[i]]
    conf = confidences[i]
    color = colors[class_ids[i]]

    cv2.rectangle(frame, (x, y), (x + w, y + h), color, 2)
    cv2.rectangle(frame, (x, y - 20), (x + w, y), color, -1)
    cv2.putText(frame, f"{label} {conf:.2f}", (x, y - 5), font, 0.6, (255, 255, 255), 2)

- draws bounding box and label with confidence on frame

12. Calculate fps

elapsed_time = time.time() - starting_time
fps = frame_id / elapsed_time
cv2.putText(frame, f"FPS: {fps:.2f}", (10, 40), font, 0.8, (0, 0, 0), 2)

- measeures frame per second and display

13. Show frame and exit

cv2.imshow("YOLOv3-Tiny Webcam", frame)

# Press ESC to exit
key = cv2.waitKey(1)
if cv2.waitKey(1) == 27:
    break

- shows the live webcam feed with boxes
- press ESC to exit

14. Release Resources

cap.release()
cv2.destroyAllWindows()

- release webcam and closeses all OpenCV windows